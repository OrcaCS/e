private Color[][] copiedRegion = null;
private int regionRadius = 50; // radius of the region to copy/paste
private boolean hasCopied = false;

@FXML
private void onMouseCopyPaste(MouseEvent event) {
    if (!(imageView.getImage() instanceof WritableImage)) return;

    WritableImage image = (WritableImage) imageView.getImage();
    PixelReader reader = image.getPixelReader();
    PixelWriter writer = image.getPixelWriter();

    double imageWidth = image.getWidth();
    double imageHeight = image.getHeight();
    double viewWidth = imageView.getBoundsInLocal().getWidth();
    double viewHeight = imageView.getBoundsInLocal().getHeight();

    double scaleX = imageWidth / viewWidth;
    double scaleY = imageHeight / viewHeight;

    int clickX = (int) (event.getX() * scaleX);
    int clickY = (int) (event.getY() * scaleY);

    if (event.getButton() == MouseButton.SECONDARY) {
        // COPY: right-click
        copiedRegion = new Color[2 * regionRadius + 1][2 * regionRadius + 1];
        for (int dx = -regionRadius; dx <= regionRadius; dx++) {
            for (int dy = -regionRadius; dy <= regionRadius; dy++) {
                int srcX = clickX + dx;
                int srcY = clickY + dy;

                if (dx * dx + dy * dy <= regionRadius * regionRadius &&
                    srcX >= 0 && srcX < imageWidth &&
                    srcY >= 0 && srcY < imageHeight) {
                    copiedRegion[dx + regionRadius][dy + regionRadius] = reader.getColor(srcX, srcY);
                }
            }
        }
        hasCopied = true;
        System.out.println("Copied region at (" + clickX + ", " + clickY + ")");
    }

    if (event.getButton() == MouseButton.PRIMARY && hasCopied) {
        // PASTE: left-click
        for (int dx = -regionRadius; dx <= regionRadius; dx++) {
            for (int dy = -regionRadius; dy <= regionRadius; dy++) {
                int destX = clickX + dx;
                int destY = clickY + dy;

                if (dx * dx + dy * dy <= regionRadius * regionRadius &&
                    destX >= 0 && destX < imageWidth &&
                    destY >= 0 && destY < imageHeight) {
                    Color color = copiedRegion[dx + regionRadius][dy + regionRadius];
                    if (color != null) {
                        writer.setColor(destX, destY, color);
                    }
                }
            }
        }
        imageView.setImage(image); // refresh image view
        System.out.println("Pasted region at (" + clickX + ", " + clickY + ")");
    }
}
